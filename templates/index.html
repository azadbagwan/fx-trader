<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX-Trader AI Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .performance-indicator {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .status-badge {
            font-size: 14px;
            padding: 8px 15px;
            border-radius: 20px;
        }
        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }
        .btn-custom {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 500;
        }
        .sidebar {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-currency-exchange"></i> FX-Trader AI
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3">
                <div class="sidebar">
                    <h5>Trading Pairs</h5>
                    <div class="mb-3">
                        <select class="form-select" id="tradingPair">
                            <option value="EURUSD">EUR/USD</option>
                            <option value="GBPUSD">GBP/USD</option>
                            <option value="USDJPY">USD/JPY</option>
                            <option value="AUDUSD">AUD/USD</option>
                        </select>
                    </div>

                    <h5 class="mt-4">Model Training</h5>
                    <div class="mb-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">End Date</label>
                        <input type="date" class="form-control" id="endDate">
                    </div>
                    <button class="btn btn-primary btn-custom w-100" onclick="trainModel()">
                        Train Model
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <!-- Status Card -->
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title">Trading Status</h5>
                            <span class="status-badge bg-success" id="botStatus">Bot Inactive</span>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-4 text-center">
                                <div class="performance-indicator" id="totalProfit">$0.00</div>
                                <div class="text-muted">Total Profit</div>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="performance-indicator" id="winRate">0%</div>
                                <div class="text-muted">Win Rate</div>
                            </div>
                            <div class="col-md-4 text-center">
                                <div class="performance-indicator" id="totalTrades">0</div>
                                <div class="text-muted">Total Trades</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chart Card -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Performance Chart</h5>
                        <div class="chart-container" id="performanceChart"></div>
                    </div>
                </div>

                <!-- Controls Card -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Trading Controls</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <button class="btn btn-success btn-custom w-100 mb-2" onclick="startTrading()">
                                    <i class="bi bi-play-fill"></i> Start Trading
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-danger btn-custom w-100 mb-2" onclick="stopTrading()">
                                    <i class="bi bi-stop-fill"></i> Stop Trading
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        // Initialize performance chart
        const trace = {
            x: [],
            y: [],
            type: 'scatter',
            mode: 'lines',
            name: 'Profit/Loss'
        };

        const layout = {
            title: 'Trading Performance',
            xaxis: { title: 'Time' },
            yaxis: { title: 'Profit/Loss ($)' }
        };

        Plotly.newPlot('performanceChart', [trace], layout);

        // Trading functions
        function trainModel() {
            const pair = document.getElementById('tradingPair').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            fetch('/train', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    ticker: pair,
                    start_date: startDate,
                    end_date: endDate
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error training model');
            });
        }

        function startTrading() {
            const pair = document.getElementById('tradingPair').value;

            fetch('/start_trading', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    ticker: pair
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('botStatus').textContent = 'Bot Active';
                document.getElementById('botStatus').classList.remove('bg-danger');
                document.getElementById('botStatus').classList.add('bg-success');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error starting trading bot');
            });
        }

        function stopTrading() {
            fetch('/stop_trading', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('botStatus').textContent = 'Bot Inactive';
                document.getElementById('botStatus').classList.remove('bg-success');
                document.getElementById('botStatus').classList.add('bg-danger');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error stopping trading bot');
            });
        }

        // Update performance metrics every 60 seconds
        setInterval(() => {
            fetch('/get_performance')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalProfit').textContent = 
                        `$${data.total_profit.toFixed(2)}`;
                    document.getElementById('totalTrades').textContent = 
                        data.total_trades;
                    
                    const winRate = data.total_trades > 0 
                        ? (data.winning_trades / data.total_trades * 100).toFixed(1)
                        : 0;
                    document.getElementById('winRate').textContent = `${winRate}%`;

                    // Update chart
                    Plotly.extendTraces('performanceChart', {
                        y: [[data.total_profit]],
                        x: [[new Date()]]
                    }, [0]);
                })
                .catch(error => console.error('Error:', error));
        }, 60000);
    </script>
</body>
</html>
